---
spec_version: 1
kind: blueprint
inputs:
  - version:
      description: that will be used as the docker images tag
      default_value: latest
      optional: true
metadata:
  description: >
    EKS deployment of todo-app
clouds:
  - AWS/EKS

ingress:
  listeners:
    - http: 80
      rules:
      - host: ${torque.sandboxId}
        path: /
        application: todo-ui
        port: 80
    - http: 7000
      rules:
      - host: ${torque.sandboxId}
        path: /todos
        application: todo-api
        port: 7000

applications:
  - todo-ui:
      input_values:
        - API_URL: $torque.applications.todo-api.dns
        - DOCKER_TAG: $version
      depends_on:
        - todo-api
  - todo-api:
      input_values:
        - DB_URL: $torque.applications.mongodb-eks.dns
        - DOCKER_TAG: $version
      depends_on:
        - mongodb-eks
  - mongodb-eks:
