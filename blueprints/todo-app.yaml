spec_version: 1
kind: blueprint
inputs: 
  - version:
      description: that will be used as the docker images tag
      default_value: latest
      optional: true
metadata:
  description: >
    EKS deployment of todo-app
clouds: 
  - AWS/EKS
applications:
  - todo-ui:
      input_values:
        - API_URL: $torque.applications.todo-api.dns
        - DOCKER_TAG: $version
      depends_on:
        - todo-api  
  - todo-api:
      input_values:
        - DB_URL: $torque.applications.mongodb-eks.dns
        - DOCKER_TAG: $version
      depends_on:
        - mongodb-eks
  - mongodb-eks:
ingress:
  listeners:
    - http: 80
      rules:
      - default: true
        application: todo-ui
        shortcut: ${torque.environment.public_address}
    - http: 7000
      rules:
      - default: true
        host: ${torque.environment.public_address}
        application: todo-api